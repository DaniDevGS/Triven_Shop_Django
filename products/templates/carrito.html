{% extends 'base.html' %}
{% load static %}

{% block content %}
<main class="container mx-auto px-4 py-8">
    <h1 class="text-3xl sm:text-4xl font-bold mb-6">Carrito de Compras</h1>

    {% if items %}
    <div class="flex flex-col lg:flex-row gap-8">
        <div class="lg:w-2/3">
            {% for item in items %}
            <div class="bg-white rounded-lg shadow-md mb-4 cart-item overflow-hidden">
                <div class="flex flex-col sm:flex-row">
                    <div class="w-full sm:w-1/4 p-3 flex items-center justify-center">
                        <img src="{{ item.imagen_url }}" class="w-full h-[150px] object-contain rounded" alt="{{ item.title }}">
                    </div>
                    <div class="w-full sm:w-3/4 p-4">
                        <div class="h-full flex flex-col justify-between">
                            <h2 class="text-xl font-bold mb-2">{{ item.title }}</h2>

                            <div class="flex items-center mb-3 gap-4">
                                <form action="{% url 'update_cart_quantity' item.producto_id %}" method="POST" class="flex items-center">
                                    {% csrf_token %}
                                    <label for="qty-{{ item.producto_id }}" class="mr-3 mb-0 font-semibold text-gray-700">Cantidad:</label>
                                    <input type="number"
                                        name="cantidad"
                                        id="qty-{{ item.producto_id }}"
                                        class="border border-gray-300 rounded-md p-1 text-sm w-[70px] focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                                        value="{{ item.cantidad }}"
                                        min="1"
                                        max="{{ item.max_stock }}"
                                        onchange="this.form.submit()">
                                </form>

                                <span class="text-xl font-bold text-green-600">${{ item.total_item_usd|floatformat:2 }} USD</span>

                                {% if item.total_item_ves %}
                                    <span class="text-xl font-bold text-yellow-600">Bs. {{ item.total_item_ves|floatformat:2 }} VES</span>
                                {% endif %}
                            </div>

                            <div class="flex justify-between items-center mt-2">
                                <span class="text-gray-500 text-sm">Precio Unitario: ${{ item.price_usd|floatformat:2 }} USD</span>

                                <form method="POST" action="{% url 'remove_from_cart' item.producto_id %}" class="m-0">
                                    {% csrf_token %}
                                    <button type="submit" class="text-red-600 hover:text-white border border-red-600 hover:bg-red-600 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-3 py-1.5 text-center transition duration-200">
                                        <i class="fa-solid fa-trash-can mr-1"></i> Eliminar
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            <div class="flex flex-col sm:flex-row gap-3 mt-6">
                <a href="{% url 'tienda' %}" class="w-full sm:w-auto">
                    <button class="w-full sm:w-auto border border-gray-400 text-gray-700 hover:bg-gray-100 font-medium rounded-lg text-base px-5 py-2.5 text-center transition duration-200">
                        Continuar Comprando
                    </button>
                </a>
                <form method="POST" action="{% url 'clear_cart' %}" class="w-full sm:w-auto">
                    {% csrf_token %}
                    <button type="submit" class="w-full sm:w-auto border border-yellow-600 text-yellow-600 hover:bg-yellow-600 hover:text-white font-medium rounded-lg text-base px-5 py-2.5 text-center transition duration-200">
                        Vaciar Carrito
                    </button>
                </form>
            </div>
        </div>
        
        <div class="lg:w-1/3 lg:mt-0">
            <div class="sticky top-20 bg-white rounded-lg shadow-xl overflow-hidden">
                <div class="bg-danger text-white font-bold p-4 text-lg">
                    Resumen del Pedido
                </div>
                <div class="p-4">
                    <ul class="divide-y divide-gray-200 mb-4">
                        <li class="flex justify-between py-2">
                            {% with items|length as item_count %}
                            <span>Subtotal ({{ item_count }} artículo{{ item_count|pluralize }}) en USD:</span>
                            {% endwith %}
                            <span class="font-semibold text-gray-900">${{ subtotal_usd|floatformat:2 }}</span>
                        </li>

                        {% if subtotal_ves %}
                        <li class="flex justify-between py-2">
                            <span>Subtotal en Bolívares (Tasa: {{ bolivar_rate|floatformat:2 }} Bs./$):</span>
                            <span class="font-semibold text-gray-900">Bs. {{ subtotal_ves|floatformat:2 }}</span>
                        </li>
                        {% endif %}

                        <li class="flex justify-between py-2">
                            <span>Costo de Envío:</span>
                            <span class="text-blue-600 font-semibold">Gratis</span>
                        </li>

                        <li class="flex justify-between py-2 pt-4">
                            <span class="text-xl font-bold">Total a Pagar (USD):</span>
                            <span class="text-xl font-bold text-green-600">${{ subtotal_usd|floatformat:2 }}</span>
                        </li>
                    </ul>
                    
                    <div class="flex flex-col gap-3">
                        <a class="bg-yellow-500 hover:bg-yellow-600 text-white text-xl font-bold py-3 px-6 rounded-lg text-center shadow-lg transition duration-200" href="{% url 'compra_productos' %}" role="button">
                            Proceder al Pago
                        </a>
                        <p class="text-center mt-2 text-gray-500 text-sm">Impuestos y cargos de importación se calcularán en el checkout.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <div class="flex justify-center my-10">
        <div class="w-full max-w-lg text-center py-12 px-6 bg-white border-2 border-dashed border-gray-300 rounded-3xl shadow-xl">
            <i class="fa-solid fa-bag-shopping text-6xl text-gray-400 mb-6 opacity-70"></i>
            
            <h2 class="text-2xl font-extrabold mb-3 text-gray-800">¡Tu Carrito Está Vacío!</h2>
            
            <p class="text-lg mb-6 text-gray-600">
                Parece que aún no has agregado productos. Explora nuestras fantásticas ofertas y encuentra algo increíble para llenar este espacio.
            </p>
            
            <a href="{% url 'tienda' %}" class="bg-blue-600 hover:bg-blue-700 text-white text-lg font-bold py-3 px-6 rounded-lg shadow-md transition duration-200">
                <i class="fa-solid fa-shop mr-2"></i> Empezar a Comprar
            </a>
        </div>
    </div>

    {% endif %}

    <hr class="my-12 border-gray-300">

</main>

<hr class="border-gray-300">

<footer class="bg-gray-800 text-white pt-8 pb-4">
    <div class="container mx-auto px-4 text-center">
        <div class="social-media mb-4">
            <a href="https://www.instagram.com/triven.shop?igsh=amFvczBxamk3emli" target="_blank" class="text-white mx-3 hover:text-red-500 transition duration-300 icons-a"><i class="fa-brands fa-instagram text-2xl"></i></a>
            <a href="https://www.tiktok.com/@triven.shop?_r=1&_t=ZM-91K5VzJkkH2" target="_blank" class="text-white mx-3 hover:text-red-500 transition duration-300 icons-a"><i class="fa-brands fa-tiktok text-2xl"></i></a>
            <a href="https://www.facebook.com/share/14Q8grURUV9/" target="_blank" class="text-white mx-3 hover:text-red-500 transition duration-300 icons-a"><i class="fa-brands fa-facebook text-2xl"></i></a>
            <a href="https://wa.me/584225924400" target="_blank" class="text-white mx-3 hover:text-red-500 transition duration-300 icons-a"><i class="fa-brands fa-whatsapp text-2xl"></i></a>
        </div>
        <div class="footer-logo mb-4">
            <img src="{% static 'img/Logo_Triven.png' %}" width="70" alt="Logotipo Trivens" class="mx-auto">
        </div>
        <p class="text-center text-sm text-gray-400">&copy; 2025 Triven Smart Shop. Todos los derechos reservados.</p>
        
    </div>
</footer>

<style>
/* El CSS personalizado de Bootstrap se ha mapeado a clases de Tailwind.
   Si necesitas una animación hover específica, puedes mantenerla aquí o
   usar la clase `hover:transform hover:-translate-y-1` de Tailwind. */
.icons-a:hover{
    color: #dc3545; /* color-red-600 */
    transform: translateY(-4px);
}
</style>
{% endblock %}