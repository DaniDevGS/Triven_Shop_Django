{% extends 'base.html' %}
{% load static %}

{% block content %}
        <main class="py-5 bg-light">
            <div class="container">
                <h1 class="mb-5 fw-bold text-center text-warning">Explora Todos Nuestros Productos</h1>
                <div class="row">
                    <div class="col-lg-3 mb-4">
                        <div class="card shadow-lg sticky-top" style="top: 80px;">
                            
                            <div class="card-header bg-danger text-white fw-bold">
                                <i class="fa-solid fa-filter me-2"></i>Filtros de Búsqueda
                            </div>
                            <div class="card-body">
                                
                                <!-- ==================================================CATEGORIAS=========================================================== -->
                                
                                    
                                <div class="mb-4 pb-2 border-bottom">
                                    <h5 class="fw-bold text-dark mb-3">Categorías</h5>
                                    <ul class="list-unstyled small">
                                        <li><a href="{% url 'tienda' %}?min_price={{ min_price|default:'' }}&max_price={{ max_price|default:'' }}" class="text-decoration-none d-block py-1 
                                                {% if not current_category %}text-warning fw-bold{% else %}text-muted{% endif %}">Todas las categorías</a></li>
                                        {% for codigo, nombre in categorias %}
                                        <li><a href="?category={{ codigo }}&min_price={{ min_price|default:'' }}&max_price={{ max_price|default:'' }}" class="text-decoration-none d-block py-1 {% if current_category == codigo %}text-warning fw-bold{% else %}text-muted{% endif %}">{{ nombre }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <!-- =============================================================================================================================== -->

                                <!-- =========================================================RANGO PRECIO=========================================================== -->
                                <div class="mb-4 pb-2 border-bottom">
                                    <h5 class="fw-bold text-dark mb-3">Rango de Precio</h5>
                                    <form method="GET" action="{% url 'tienda' %}">
                                        {% if current_category %}
                                            <input type="hidden" name="category" value="{{ current_category }}">
                                        {% endif %}

                                        <div class="mb-3">
                                            <label for="min_price" class="form-label small text-danger">Precio Mínimo ($)</label>
                                            <input type="number" name="min_price" id="min_price" class="form-control form-control-sm text-warning" 
                                                   value="{{ min_price|default:'0' }}" min="0" step="1">
                                        </div>

                                        <div class="col">
                                            <label for="max_price" class="form-label small text-danger">Precio Máximo ($)</label>
                                            <input type="number"
                                            name="max_price" id="max_price" class="form-control form-control-sm  text-warning" 
                                                   value="{{ max_price|default:'1500' }}" min="0" step="1">
                                        </div>

                                        <button type="submit" class="btn btn-sm btn-outline-danger w-100 mt-1">Aplicar Filtro</button>
                                    </form>
                                </div>
                                <!-- =============================================================================================================================== -->
                                <!-- =============================================================================================================================== -->
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-9">

                        <div class="mb-4">
                            <form method="GET" action="{% url 'tienda' %}" class="input-group input-group-lg shadow-sm border border-danger rounded-pill overflow-hidden">
                                
                                {% if current_category %}
                                    <input type="hidden" name="category" value="{{ current_category }}">
                                {% endif %}
                                {% if min_price %}
                                    <input type="hidden" name="min_price" value="{{ min_price }}">
                                {% endif %}
                                {% if max_price %}
                                    <input type="hidden" name="max_price" value="{{ max_price }}">
                                {% endif %}

                                <input type="text" 
                                    name="q" 
                                    class="form-control border-0 p-3 text-dark fw-bold" 
                                    placeholder="Busca productos"
                                    aria-label="Término de búsqueda"
                                    value="{{ search_query|default:'' }}">
                                
                                <button class="btn btn-danger px-4" type="submit" id="button-addon2">
                                    <i class="fa-solid fa-magnifying-glass me-1"></i> Buscar
                                </button>
                            </form>
                        </div>
                        
                        <!-- =========================================================MOSTRAR PRODUCTOS=========================================================== -->
                        <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-white rounded shadow-sm border border-info">
                            <p class="mb-0 text-muted small">Mostrando {{ cantidad }} productos disponibles</p>
                        </div>
                        <!-- ======================================================================================================================================= -->

                        <!-- =========================================================PRODUCTOS CONTENEDOR=========================================================== -->
                        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-lg-3 g-4 articles-products">
                            <!-- =========================================================PRODUCTOS=========================================================== -->
                        {% for producto in productos %}
                            {% if user.is_authenticated %}     
                            <div class="col">
                                <a href="{% url 'products_items' producto.id %}" class="text-decoration-none text-dark d-block h-100">
                                    <div class="card h-100 shadow-lg products hover-shadow-lg">
                                        <img src="{{ producto.imagen.url }}" class="card-img-top products-img" alt="{{ producto.title }}" style="height: 250px; object-fit: cover;">
                                        <div class="card-body d-flex flex-column products-info">
                                            <h5 class="card-title product-title">{{ producto.title }}</h5>
                                            <p class="card-text product-description flex-grow-1">{{ producto.description|truncatewords:20 }}</p>
                                            <span class="fs-4 fw-bold text-success price">{{ producto.price }}$</span>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                
                                                <span class="fs-4 fw-bold text-warning price-bolivar">({{ producto.price_ves|floatformat:2 }}Bs)</span>
                                            </div>
                                            <!-- <form method="POST" action="{% url 'add_to_cart' %}" class="mt-3">
                                                {% csrf_token %}
                                                <input type="hidden" name="producto_id" value="{{ producto.id }}">
                                                
                                                <div class="input-group input-group-sm mb-2">
                                                    <label class="input-group-text small bg-light" for="cantidad-{{ producto.id }}">Cant.</label>
                                                    <input type="number" 
                                                            name="cantidad" 
                                                            id="cantidad-{{ producto.id }}" 
                                                            class="form-control" 
                                                            value="1" 
                                                            min="1" 
                                                            max="{{ producto.cantidad }}" 
                                                            style="max-width: 70px;">
                                    
                                                    <button type="submit" class="btn btn-danger">
                                                        <i class="fa-solid fa-cart-plus me-1"></i>Añadir
                                                    </button>
                                                </div>
                                            </form> -->
                                            
                                        </div>
                                    </div>
                                </a>
                            </div>
                            {% else %}
                            <div class="col">
                                <a href="{% url 'signup' %}" class="text-decoration-none text-dark d-block h-100">
                                    <div class="card h-100 shadow-lg products hover-shadow-lg">
                                        <img src="{{ producto.imagen.url }}" class="card-img-top products-img" alt="{{ producto.title }}" style="height: 250px; object-fit: cover;">
                                        <div class="card-body d-flex flex-column products-info">
                                            <h5 class="card-title product-title">{{ producto.title }}</h5>
                                            <p class="card-text product-description flex-grow-1 producto_descripcion">{{ producto.description }}</p>
                                            <span class="fs-4 fw-bold text-success price">{{ producto.price }}$</span>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                
                                                <span class="fs-4 fw-bold text-warning price-bolivar">({{ producto.price_ves|floatformat:2 }}Bs)</span>
                                            </div>
                                            <form method="POST" action="{% url 'add_to_cart' %}" class="mt-3">
                                                {% csrf_token %}
                                                <input type="hidden" name="producto_id" value="{{ producto.id }}">
                                                
                                                <div class="input-group input-group-sm mb-2">
                                                    <label class="input-group-text small bg-light" for="cantidad-{{ producto.id }}">Cant.</label>
                                                    <input type="number" 
                                           name="cantidad" 
                                           id="cantidad-{{ producto.id }}" 
                                           class="form-control" 
                                           value="1" 
                                           min="1" 
                                           max="99" 
                                           style="max-width: 70px;">
                                    
                                                    <button type="submit" class="btn btn-danger">
                                                        <i class="fa-solid fa-cart-plus me-1"></i>Añadir
                                                    </button>
                                                </div>
                                            </form>
                                            
                                        </div>
                                    </div>
                                </a>
                            </div>

                            {% endif %}
                        {% endfor %}

                            <!-- ==================================================================================================================================== -->
                        <!-- ======================================================================================================================================== -->
                        </div>
                        
                    </div>
                    </div>
            </div>
        </main>

        <footer class="bg-dark text-white pt-4 pb-2 container-fluid">
            <div class="container text-center">
                <div class="social-media mb-3">
                    <a href="https://www.instagram.com/triven.shop?igsh=amFvczBxamk3emli" target="_blank" class="text-white mx-2"><i class="fa-brands fa-instagram fa-2x icons-a"></i></a>
                    <a href="https://www.tiktok.com/@triven.shop?_r=1&_t=ZM-91K5VzJkkH2" target="_blank" class="text-white mx-2"><i class="fa-brands fa-tiktok fa-2x icons-a"></i></a>
                    <a href="https://www.facebook.com/share/14Q8grURUV9/" target="_blank" class="text-white mx-2 icons-a"><i class="fa-brands fa-facebook fa-2x icons-a"></i></a>
                    <a href="https://wa.me/584225924400" target="_blank" class="text-white mx-2"><i class="fa-brands fa-whatsapp fa-2x icons-a"></i></a>
                </div>
                <div class="footer-logo mb-3">
                    <img src="{% static 'img/Logo_Triven.png' %}" width="70" alt="Logotipo Trivens">
                </div>
                <p class="text-center"><small>&copy; 2025 Triven Smart Shop. Todos los derechos reservados.</small></p>
                
            </div>
        </footer>
<style>
    .producto_descripcion{
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        line-clamp: 5;
        -webkit-line-clamp: 3;
    }

    .icons-a:hover{
        color: #dc3545;
        transform: translateY(-4px);
    }
    /* Animación de interacción para las tarjetas de producto */
    .products {
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    }
    .products:hover {
        transform: translateY(-5px) scale(1.01); /* Ligeramente se levanta y agranda */
        box-shadow: 0 12px 20px rgba(0, 0, 0, 0.1); /* Sombra que simula elevación */
        border: 1px solid #dc3545; /* Resalta el borde para mejor indicación */
    }

    /* Animación de hover para los enlaces de categorías en el filtro */
    .list-unstyled a {
        transition: color 0.2s ease, padding-left 0.2s ease;
        position: relative;
        padding-left: 10px;
    }
    .list-unstyled a:hover {
        color: #dc3545 !important; /* Rojo al pasar el ratón */
        padding-left: 15px; /* Pequeño deslizamiento a la derecha */
    }
    .list-unstyled a:hover::before {
        content: '•';
        position: absolute;
        left: 0;
        color: #dc3545;
    }
    /* Estilo del botón de búsqueda al hacer hover */
    #button-addon2 {
        transition: background-color 0.3s ease, transform 0.2s ease;
    }
    #button-addon2:hover {
        background-color: #c82333; /* Rojo más oscuro */
        transform: scale(1.02);
    }
</style>
{% endblock %}