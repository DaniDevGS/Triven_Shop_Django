{% extends 'base.html' %}
{% load static %}

{% block content %}
        <main class="py-5 bg-light">
            <div class="container">
                <h1 class="mb-5 fw-bold text-center text-warning">Explora Todos Nuestros Productos</h1>
                <div class="row">
                    <div class="col-lg-3 mb-4">
                        <div class="card shadow-lg sticky-top" style="top: 80px;">
                            
                            <div class="card-header bg-danger text-white fw-bold">
                                <i class="fa-solid fa-filter me-2"></i>Filtros de Búsqueda
                            </div>
                            <div class="card-body">
                                
                                <!-- ==================================================CATEGORIAS=========================================================== -->
                                
                                    
                                <div class="mb-4 pb-2 border-bottom">
                                    <h5 class="fw-bold text-dark mb-3">Categorías</h5>
                                    <ul class="list-unstyled small">
                                        <li><a href="{% url 'tienda' %}?min_price={{ min_price|default:'' }}&max_price={{ max_price|default:'' }}" class="text-decoration-none d-block py-1 
                                                {% if not current_category %}text-warning fw-bold{% else %}text-muted{% endif %}">Todas las categorías</a></li>
                                        {% for codigo, nombre in categorias %}
                                        <li><a href="?category={{ codigo }}&min_price={{ min_price|default:'' }}&max_price={{ max_price|default:'' }}" class="text-decoration-none d-block py-1 {% if current_category == codigo %}text-warning fw-bold{% else %}text-muted{% endif %}">{{ nombre }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <!-- =============================================================================================================================== -->

                                <!-- =========================================================RANGO PRECIO=========================================================== -->
                                <div class="mb-4 pb-2 border-bottom">
                                    <h5 class="fw-bold text-dark mb-3">Rango de Precio</h5>
                                    <form method="GET" action="{% url 'tienda' %}">
                                        {% if current_category %}
                                            <input type="hidden" name="category" value="{{ current_category }}">
                                        {% endif %}

                                        <div class="mb-3">
                                            <label for="min_price" class="form-label small text-danger">Precio Mínimo ($)</label>
                                            <input type="number" name="min_price" id="min_price" class="form-control form-control-sm text-warning" 
                                                   value="{{ min_price|default:'0' }}" min="0" step="1">
                                        </div>

                                        <div class="col">
                                            <label for="max_price" class="form-label small text-danger">Precio Máximo ($)</label>
                                            <input type="number"
                                            name="max_price" id="max_price" class="form-control form-control-sm  text-warning" 
                                                   value="{{ max_price|default:'1500' }}" min="0" step="1">
                                        </div>

                                        <button type="submit" class="btn btn-sm btn-outline-danger w-100 mt-1">Aplicar Filtro</button>
                                    </form>
                                </div>
                                <!-- =============================================================================================================================== -->
                                <!-- =============================================================================================================================== -->
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-9">
                        
                        <!-- =========================================================MOSTRAR PRODUCTOS=========================================================== -->
                        <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-white rounded shadow-sm border border-info">
                            <p class="mb-0 text-muted small">Mostrando {{ cantidad }} ** productos disponibles</p>
                            <!-- <div class="d-flex align-items-center">
                                <label for="sort-by" class="form-label me-2 mb-0 d-none d-md-block small fw-bold">Ordenar por:</label>
                                <select class="form-select form-select-sm" id="sort-by" style="width: auto;">
                                    <option selected>Más Relevante</option>
                                    <option value="1">Precio: Menor a Mayor</option>
                                    <option value="2">Precio: Mayor a Menor</option>
                                </select>
                            </div> -->
                        </div>
                        <!-- ======================================================================================================================================= -->

                        <!-- =========================================================PRODUCTOS CONTENEDOR=========================================================== -->
                        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-lg-3 g-4 articles-products">
                            <!-- =========================================================PRODUCTOS=========================================================== -->
                        {% for producto in productos %}
                            {% if user.is_authenticated %}     
                            <div class="col">
                                <a href="{% url 'products_items' producto.id %}" class="text-decoration-none text-dark d-block h-100">
                                    <div class="card h-100 shadow-lg products hover-shadow-lg">
                                        <img src="{{ producto.imagen.url }}" class="card-img-top products-img" alt="{{ producto.title }}" style="height: 250px; object-fit: cover;">
                                        <div class="card-body d-flex flex-column products-info">
                                            <h5 class="card-title product-title">{{ producto.title }}</h5>
                                            <p class="card-text product-description flex-grow-1">{{ producto.description }}</p>
                                            <span class="fs-4 fw-bold text-success price">{{ producto.price }}$</span>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                
                                                <span class="fs-4 fw-bold text-warning price-bolivar">({{ producto.price_ves|floatformat:2 }}Bs)</span>
                                            </div>
                                            <form method="POST" action="{% url 'add_to_cart' %}" class="mt-3">
                                                {% csrf_token %}
                                                <input type="hidden" name="producto_id" value="{{ producto.id }}">
                                                
                                                <div class="input-group input-group-sm mb-2">
                                                    <label class="input-group-text small bg-light" for="cantidad-{{ producto.id }}">Cant.</label>
                                                    <input type="number" 
                                           name="cantidad" 
                                           id="cantidad-{{ producto.id }}" 
                                           class="form-control" 
                                           value="1" 
                                           min="1" 
                                           max="{{ producto.cantidad }}" 
                                           style="max-width: 70px;">
                                    
                                                    <button type="submit" class="btn btn-danger">
                                                        <i class="fa-solid fa-cart-plus me-1"></i>Añadir
                                                    </button>
                                                </div>
                                            </form>
                                            
                                        </div>
                                    </div>
                                </a>
                            </div>
                            {% else %}
                            <div class="col">
                                <a href="{% url 'signup' %}" class="text-decoration-none text-dark d-block h-100">
                                    <div class="card h-100 shadow-lg products hover-shadow-lg">
                                        <img src="{{ producto.imagen.url }}" class="card-img-top products-img" alt="{{ producto.title }}" style="height: 250px; object-fit: cover;">
                                        <div class="card-body d-flex flex-column products-info">
                                            <h5 class="card-title product-title">{{ producto.title }}</h5>
                                            <p class="card-text product-description flex-grow-1">{{ producto.description }}</p>
                                            <span class="fs-4 fw-bold text-success price">{{ producto.price }}$</span>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                
                                                <span class="fs-4 fw-bold text-warning price-bolivar">({{ producto.price_ves|floatformat:2 }}Bs)</span>
                                            </div>
                                            <form method="POST" action="{% url 'add_to_cart' %}" class="mt-3">
                                                {% csrf_token %}
                                                <input type="hidden" name="producto_id" value="{{ producto.id }}">
                                                
                                                <div class="input-group input-group-sm mb-2">
                                                    <label class="input-group-text small bg-light" for="cantidad-{{ producto.id }}">Cant.</label>
                                                    <input type="number" 
                                           name="cantidad" 
                                           id="cantidad-{{ producto.id }}" 
                                           class="form-control" 
                                           value="1" 
                                           min="1" 
                                           max="99" 
                                           style="max-width: 70px;">
                                    
                                                    <button type="submit" class="btn btn-danger">
                                                        <i class="fa-solid fa-cart-plus me-1"></i>Añadir
                                                    </button>
                                                </div>
                                            </form>
                                            
                                        </div>
                                    </div>
                                </a>
                            </div>

                            {% endif %}
                        {% endfor %}

                            <!-- ==================================================================================================================================== -->
                        <!-- ======================================================================================================================================== -->
                        </div>
                        
                    </div>
                    </div>
            </div>
        </main>

        <footer class="bg-dark text-white pt-4 pb-2">
            <div class="container text-center">
                <div class="social-media mb-3">
                    <a href="#" class="text-white mx-2"><i class="fa-brands fa-instagram fa-2x"></i></a>
                    <a href="#" class="text-white mx-2"><i class="fa-brands fa-tiktok fa-2x"></i></a>
                    <a href="#" class="text-white mx-2"><i class="fa-brands fa-facebook fa-2x"></i></a>
                    <a href="+58 422-5924400" class="text-white mx-2"><i class="fa-brands fa-whatsapp fa-2x"></i></a>
                </div>
                <div class="footer-logo mb-3">
                    <img src="{% static 'img/Logo_Triven.svg' %}" width="70" alt="Logotipo Trivens">
                </div>
                <p class="text-muted"><small>&copy; 2025 Triven Smart Shop. Todos los derechos reservados.</small></p>
            </div>
        </footer>
        
{% endblock %}