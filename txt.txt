Actua como desarrollador Full Stack, ayudame a hacer que cuando un manager le de al boton rechazar o aprobar este abra un input de texto en donde el manager escribira texto por ejemplo porque un pago fue rechazado o si es aprovado en cuanto tiempo llegara su pedido.

products/views.py

def pagos_verificar(request):
    # ...
    ordenes_pendientes = OrdenDeCompra.objects.filter(estado='PENDIENTE').order_by('-fecha_orden')
    
    context = {
        'ordenes_pendientes': ordenes_pendientes,
        'sent_view': False # Indica que estamos en la vista de pendientes
    }
    return render(request, 'manager/pagos_verificar.html', context)


def pagos_aprovados(request):
    # ...
    ordenes_aprovadas = OrdenDeCompra.objects.filter(estado='APROBADA').order_by('-fecha_orden')
    
    context = {
        'ordenes_aprovadas': ordenes_aprovadas, # Las órdenes aprobadas
        'sent_view': True # Indica que estamos en la vista de aprobadas
    }
    return render(request, 'manager/pagos_verificar.html', context)

def pagos_rechazados(request):
    ordenes_rechazadas = OrdenDeCompra.objects.filter(estado='RECHAZADA').order_by('-fecha_orden')

    context = {
        'ordenes_rechazadas': ordenes_rechazadas,
        'orden_rechazar': True
    }
    return render(request, 'manager/pagos_verificar.html', context)
    

@login_required
@require_POST # Se recomienda usar POST para cambios de estado
def orden_aprobar(request, orden_id):
    """Marca una OrdenDeCompra como APROBADA y guarda la nota del manager."""
    orden = get_object_or_404(OrdenDeCompra, pk=orden_id)
    
    # 1. Obtener la nota del manager del POST
    nota_manager = request.POST.get('nota_manager', '').strip()
    
    # Solo se puede aprobar si está PENDIENTE
    if orden.estado == 'PENDIENTE':
        # 2. Guardar el estado y la nota
        orden.estado = 'APROBADA'
        orden.nota_manager = nota_manager # Guardamos la nota
        orden.save()
        messages.success(request, f"La orden ID **{orden.id_compra}** ha sido APROBADA. Nota: {nota_manager[:50]}...")
    else:
        messages.error(request, f"La orden ID **{orden.id_compra}** ya está en estado {orden.estado}.")
        
    return redirect('pagos_verificar')

@login_required
@require_POST # Se recomienda usar POST para cambios de estado
def orden_rechazar(request, orden_id):
    """Marca una OrdenDeCompra como RECHAZADA, revierte el stock y guarda la nota."""
    orden = get_object_or_404(OrdenDeCompra, pk=orden_id)

    # 1. Obtener la nota del manager del POST
    nota_manager = request.POST.get('nota_manager', '').strip()
    
    if orden.estado == 'PENDIENTE':
        try:
            with transaction.atomic():
                # 2. Cambiar estado a RECHAZADA y guardar la nota
                orden.estado = 'RECHAZADA'
                orden.nota_manager = nota_manager # Guardamos la nota
                orden.save()
                
                # 3. Revertir el stock de todos los productos
                for item in orden.items_orden.all(): # type: ignore
                    producto = item.producto
                    producto.cantidad += item.cantidad # Devolver la cantidad al stock
                    producto.save()
                    
                messages.warning(request, f"La orden ID **{orden.id_compra}** ha sido RECHAZADA y el stock ha sido revertido. Razón: {nota_manager[:50]}...")
                
        except Exception as e:
            messages.error(request, f"Error al rechazar la orden y revertir stock: {str(e)}")
    else:
        messages.error(request, f"La orden ID **{orden.id_compra}** no puede ser rechazada. Estado actual: {orden.estado}.")
    
    return redirect('pagos_verificar')



products/templates/manager/pagos_verificar.html

{% extends 'manager/base.html' %}

{% block content %}
<main class="container py-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            {% if sent_view %}
            <h1 class="text-center display-4 fw-bold text-success mb-5"><i class="fa-solid fa-certificate"></i>Pagos aprovados</h1>
            {% elif orden_rechazar %}
            <h1 class="text-center display-4 fw-bold text-danger mb-5"><i class="fa-regular fa-circle-xmark"></i>Pagos rechazados</h1>
            {% else %}
            <h1 class="text-center display-4 fw-bold text-info mb-5"><i class="fa-solid fa-file-import"></i>Pagos verificar</h1>
            {% endif %}

            {% if ordenes_pendientes %}
            <div class="row g-4">
                {% for orden in ordenes_pendientes %}
                    <div class="col-12">
                        <div class="card shadow-sm {% if sent_view %}border-success{% else %}border-warning{% endif %}">
                            <div class="card-body"> 
                                <header class="d-flex justify-content-between align-items-center mb-3">
                                    <h2 class="card-title fw-bold text-truncate text-primary">ID: {{ orden.id_compra }}</h2>
                                    <span class="badge bg-secondary-subtle text-secondary py-2 px-3">
                                        <i class="fa-solid fa-user me-1"></i>Usuario: {{ orden.user.username }}
                                    </span>
                                </header>

                                <hr>
                            
                                <div class="row">
                                    <div class="col-md-8">
                                        <h5 class="fw-bolder mb-3 text-secondary">Productos comprados</h5>

                                        <ul class="list-group list-group-flush mb-4">
                                            {% for item in orden.items_orden.all %}
                                            <li class="list-group-item d-flex justify-content-between align-items-center ps-0">
                                                <div class="text-dark">
                                                    {{ item.producto.title }}
                                                    <span class="badge bg-secondary-subtle text-dark ms-2">x{{ item.cantidad }}</span>
                                                </div>

                                                <small class="text-muted fw-bold">${{ item.total_item|floatformat:2 }}</small>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>

                                <p class="card-text text-muted mb-2">Total pago: ${{ orden.subtotal_usd|floatformat:2 }}</p>

                                <div class="d-flex justify-content-between align-items-end mb-3">
                                    <small class="text-info fw-bold">
                                        <i class="fa-regular fa-calendar-alt me-1"></i>{{ orden.fecha_orden|date:"d M Y" }}
                                        <span class="text-muted">a las {{ orden.fecha_orden|date:'H:i' }}</span>
                                    </small>
                                    
                                    {% if orden.imagen_comprobante %}
                                    <a href="{{ orden.imagen_comprobante.url }}" target="_blank">
                                        <img src="{{ orden.imagen_comprobante.url }}" alt="Comprobante de Pago {{ orden.id_compra }}" class="img-thumbnail rounded" style="width: 80px; height: 80px; object-fit: cover;">
                                    </a>
                                    {% else %}
                                    <p class="text-danger text-center"><i class="fa-solid fa-triangle-exclamation me-1"></i> Sin Comprobante</p>
                                    {% endif %}
                                </div>

                                <div class="d-flex justify-content-end gap-2 pt-3 border-top">
                                    
                                    <form method="POST" action="{% url 'orden_aprobar' orden.id %}">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-success">
                                            <i class="fa-solid fa-check-circle me-1"></i> Aprobar
                                        </button>
                                    </form>

                                    <form method="POST" action="{% url 'orden_rechazar' orden.id %}">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-danger">
                                            <i class="fa-solid fa-times-circle me-1"></i> Rechazar
                                        </button>
                                    </form>
                                </div>
                                </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            {% elif ordenes_aprovadas %}
            <div class="row g-4">
                {% for orden in ordenes_aprovadas %}
                    <div class="col-12">
                        <div class="card shadow-sm {% if sent_view %}border-success{% else %}border-warning{% endif %}">
                            <div class="card-body"> 
                                <header class="d-flex justify-content-between align-items-center mb-3">
                                    <h2 class="card-title fw-bold text-truncate text-primary">ID: {{ orden.id_compra }}</h2>
                                    <span class="badge bg-secondary-subtle text-secondary py-2 px-3">
                                        <i class="fa-solid fa-user me-1"></i>Usuario: {{ orden.user.username }}
                                    </span>
                                </header>

                                <hr>
                            
                                <div class="row">
                                    <div class="col-md-8">
                                        <h5 class="fw-bolder mb-3 text-secondary">Productos comprados</h5>

                                        <ul class="list-group list-group-flush mb-4">
                                            {% for item in orden.items_orden.all %}
                                            <li class="list-group-item d-flex justify-content-between align-items-center ps-0">
                                                <div class="text-dark">
                                                    {{ item.producto.title }}
                                                    <span class="badge bg-secondary-subtle text-dark ms-2">x{{ item.cantidad }}</span>
                                                </div>

                                                <small class="text-muted fw-bold">${{ item.total_item|floatformat:2 }}</small>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>

                                <p class="card-text text-muted mb-2">Total pago: ${{ orden.subtotal_usd|floatformat:2 }}</p>

                                <div class="d-flex justify-content-between align-items-end mb-3">
                                    <small class="text-info fw-bold">
                                        <i class="fa-regular fa-calendar-alt me-1"></i>{{ orden.fecha_orden|date:"d M Y" }}
                                        <span class="text-muted">a las {{ orden.fecha_orden|date:'H:i' }}</span>
                                    </small>
                                    
                                    {% if orden.imagen_comprobante %}
                                    <a href="{{ orden.imagen_comprobante.url }}" target="_blank">
                                        <img src="{{ orden.imagen_comprobante.url }}" alt="Comprobante de Pago {{ orden.id_compra }}" class="img-thumbnail rounded" style="width: 80px; height: 80px; object-fit: cover;">
                                    </a>
                                    {% else %}
                                    <p class="text-danger text-center"><i class="fa-solid fa-triangle-exclamation me-1"></i> Sin Comprobante</p>
                                    {% endif %}
                                </div>

                                <div class="d-flex justify-content-end gap-2 pt-3 border-top">
                                    
                                    <form method="POST" action="{% url 'orden_aprobar' orden.id %}">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-success">
                                            <i class="fa-solid fa-check-circle me-1"></i> Aprobar
                                        </button>
                                    </form>

                                    <form method="POST" action="{% url 'orden_rechazar' orden.id %}">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-danger">
                                            <i class="fa-solid fa-times-circle me-1"></i> Rechazar
                                        </button>
                                    </form>
                                </div>
                                </div>
                        </div>
                    </div>
                {% endfor %}
            </div>


            {% elif ordenes_rechazadas %}
            <div class="row g-4">
                {% for orden in ordenes_rechazadas %}
                    <div class="col-12">
                        <div class="card shadow-sm {% if sent_view %}border-success{% else %}border-warning{% endif %}">
                            <div class="card-body"> 
                                <header class="d-flex justify-content-between align-items-center mb-3">
                                    <h2 class="card-title fw-bold text-truncate text-primary">ID: {{ orden.id_compra }}</h2>
                                    <span class="badge bg-secondary-subtle text-secondary py-2 px-3">
                                        <i class="fa-solid fa-user me-1"></i>Usuario: {{ orden.user.username }}
                                    </span>
                                </header>

                                <hr>
                            
                                <div class="row">
                                    <div class="col-md-8">
                                        <h5 class="fw-bolder mb-3 text-secondary">Productos comprados</h5>

                                        <ul class="list-group list-group-flush mb-4">
                                            {% for item in orden.items_orden.all %}
                                            <li class="list-group-item d-flex justify-content-between align-items-center ps-0">
                                                <div class="text-dark">
                                                    {{ item.producto.title }}
                                                    <span class="badge bg-secondary-subtle text-dark ms-2">x{{ item.cantidad }}</span>
                                                </div>

                                                <small class="text-muted fw-bold">${{ item.total_item|floatformat:2 }}</small>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>

                                <p class="card-text text-muted mb-2">Total pago: ${{ orden.subtotal_usd|floatformat:2 }}</p>

                                <div class="d-flex justify-content-between align-items-end mb-3">
                                    <small class="text-info fw-bold">
                                        <i class="fa-regular fa-calendar-alt me-1"></i>{{ orden.fecha_orden|date:"d M Y" }}
                                        <span class="text-muted">a las {{ orden.fecha_orden|date:'H:i' }}</span>
                                    </small>
                                    
                                    {% if orden.imagen_comprobante %}
                                    <a href="{{ orden.imagen_comprobante.url }}" target="_blank">
                                        <img src="{{ orden.imagen_comprobante.url }}" alt="Comprobante de Pago {{ orden.id_compra }}" class="img-thumbnail rounded" style="width: 80px; height: 80px; object-fit: cover;">
                                    </a>
                                    {% else %}
                                    <p class="text-danger text-center"><i class="fa-solid fa-triangle-exclamation me-1"></i> Sin Comprobante</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            {% else %}
            <div class="alert alert-info" role="alert">
                <i class="fa-solid fa-info-circle me-2"></i> No hay órdenes pendientes de verificación en este momento.
            </div>
            {% endif %}
            
        </div>
    </div>
</main>
{% endblock %}


djangologic/urls.py

"""
URL configuration for djangologic project.

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/5.2/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""
from django.contrib import admin
from django.urls import path
from products import views
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),

    #=================================VIEWS DE Trivens======================================================
    path('', views.index, name='index'),
    path('tienda/', views.products_store, name='tienda'),
    path('signup/', views.signup, name='signup'),
    path('logout/', views.signout, name='logout'),
    path('signin/', views.signin, name='signin'),
    path('carrito/', views.carrito, name='carrito'),
    path('carrito/add/', views.add_to_cart, name='add_to_cart'),
    path('carrito/remove/<int:producto_id>/', views.remove_from_cart, name='remove_from_cart'),
    path('carrito/update/<int:producto_id>/', views.update_cart_quantity, name='update_cart_quantity'),
    path('carrito/clear/', views.clear_cart, name='clear_cart'), # Opcional: si creas una vista para vaciar todo
    path('compra', views.compra_productos, name='compra_productos'),

    #=================================VIEWS DE USER======================================================
    path('user_detail', views.user_details, name='user_detail'),

    path('tienda/<int:products_id>/', views.products_items, name='products_items'),

    #=================================VIEWS DE PRODUCTS Manager======================================================
    path('manager/', views.home, name='manage'),
    path('manager/products/', views.products, name='products'),
    path('manager/products_to_send/', views.products_to_send, name='products_to_send'),
    path('manager/product/create/', views.create_product, name='create_product'),
    path('manager/products/<int:products_id>/', views.product_detail, name='products_detail'),
    # urls.py
    path('manager/products/<int:products_id>/complete', views.sent_product, name='complete_products'), # type: ignore
    path('manager/products/<int:products_id>/delete', views.delete_product, name='delete_products'), # <-- Asegúrate de la coma # type: ignore
    #=================================VIEWS DE PRODUCTS Manager======================================================
    path('manager/pagos_verificar', views.pagos_verificar, name='pagos_verificar'),
    path('manager/pagos_aprovados', views.pagos_aprovados, name='pagos_aprovados'),
    path('manager/pagos_rechazados', views.pagos_rechazados, name='pagos_rechazados'),

    # Rutas de Aprobación/Rechazo (NUEVAS)
    path('manager/orden/<int:orden_id>/aprobar/', views.orden_aprobar, name='orden_aprobar'),
    path('manager/orden/<int:orden_id>/rechazar/', views.orden_rechazar, name='orden_rechazar'),
    

]

if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)